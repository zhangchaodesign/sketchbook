(function(t){function e(e){for(var n,r,i=e[0],l=e[1],c=e[2],h=0,d=[];h<i.length;h++)r=i[h],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&d.push(s[r][0]),s[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],n=!0,i=1;i<o.length;i++){var l=o[i];0!==s[l]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=o[0]))}return t}var n={},s={app:0},a=[];function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=n,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;a.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},1:function(t,e){},2:function(t,e){},3:function(t,e){},"318a":function(t,e,o){"use strict";var n=o("bb1f"),s=o.n(n);s.a},3329:function(t,e,o){"use strict";var n=o("73d7"),s=o.n(n);s.a},"56d7":function(t,e,o){"use strict";o.r(e);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("2b0e"),s=o("2222"),a=o.n(s),r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("router-view")],1)},i=[],l=o("2877"),c={},u=Object(l["a"])(c,r,i,!1,null,null,null),h=u.exports,d=(o("b0c0"),o("a4d3"),o("e01a"),o("2f62")),p=o("d4ec"),f=o("bee2"),m=(o("a434"),o("ac1f"),function(){function t(e){Object(p["a"])(this,t),this.limit=e,this.history=[],this.current=0}return Object(f["a"])(t,[{key:"add",value:function(t){this.history.splice(this.current,this.history.length),this.history.length>=this.limit&&this.history.shift(),this.history.push(t),this.current=this.history.length,localStorage.vdarw=a.a.project.exportJSON()}},{key:"undo",value:function(){this.canUndo()&&this.history[--this.current].unexec()}},{key:"redo",value:function(){this.canRedo()&&this.history[this.current++].exec()}},{key:"canUndo",value:function(){return this.current>0}},{key:"canRedo",value:function(){return this.history.length>this.current}},{key:"clear",value:function(){this.history=[],this.current=0,localStorage.vdarw="[]"}}]),t}()),v=new m(20),g=o("2909"),b=o("4c17"),w=o.n(b),y=function(){function t(e){var o=e.path;Object(p["a"])(this,t),this._args={path:o},o.name=w()()}return Object(f["a"])(t,[{key:"exec",value:function(){var t;this.removed&&(t=this._args.path).add.apply(t,Object(g["a"])(this.removed))}},{key:"unexec",value:function(){this.removed=this._args.path.removeSegments()}}]),t}(),k={path:null,show:null},S={lastSize:0,lastColor:"#00000FF"},C=function(t){k.show&&k.show.layer===a.a.project.activeLayer&&S.lastSize===Y.state.pencilArgs.size&&S.lastColor===Y.state.pencilArgs.color||(k.show&&k.show.remove(),k.show=null,k.show=new a.a.Path.Circle({center:[0,0],radius:Y.state.pencilArgs.size/2,fillColor:Y.state.pencilArgs.color}),S.lastSize=Y.state.pencilArgs.size,S.lastColor=Y.state.pencilArgs.color),k.show.position=t.point},j=function(t){k.path=new a.a.Path,k.path.strokeColor=Y.state.pencilArgs.color,k.path.strokeWidth=Y.state.pencilArgs.size,k.path.strokeCap="round",k.path.strokeJoin="round",k.path.add(t.point)},z=function(t){k.path&&k.path.add(t.point)},O=function(t){k.path.add(t.point),Y.state.pencilArgs.shake&&k.path.simplify(),v.add(new y({path:k.path})),k.path=null,k.show&&k.show.remove(),k.show=null},$=function(){},A=function(){k.show&&k.show.remove(),k.show=null},x=new a.a.Tool;x.onMouseDown=j,x.onMouseDrag=z,x.onMouseUp=O,x.onMouseMove=C,x.onToggleIn=$,x.onToggleOut=A;var T={path:null,show:null},_={lastSize:0},L=function(t){T.show&&T.show.layer===a.a.project.activeLayer&&_.layer===Y.state.eraserArgs.size||(T.show&&T.show.remove(),T.show=null,T.show=new a.a.Path.Circle({center:[0,0],radius:Y.state.eraserArgs.size/2,strokeColor:"black",fillColor:"white"}),_.lastSize=Y.state.eraserArgs.size),T.show.position=t.point},N=function(t){T.path=new a.a.Path,T.path.strokeColor="white",T.path.strokeWidth=Y.state.eraserArgs.size,T.path.blendMode="destination-out",T.path.strokeCap="round",T.path.strokeJoin="round",T.path.add(t.point)},B=function(t){T.show&&(T.show.position=t.point,T.show.bringToFront()),T.path&&T.path.add(t.point)},P=function(t){T.path.add(t.point),v.add(new y({path:T.path})),T.path=null},V=function(){},E=function(){T.show&&T.show.remove(),T.show=null},M=new a.a.Tool;M.onMouseDown=N,M.onMouseDrag=B,M.onMouseUp=P,M.onMouseMove=L,M.onToggleIn=V,M.onToggleOut=E;var D={prevSelection:null};function I(){if(D.prevSelection){var t=D.prevSelection.path||D.prevSelection;t.bounds.selected=!1,t.selected=!1,D.prevSelection.selected=!1,D.prevSelection=null}}var F=function(t){I();var e=a.a.project.hitTest(t.point,{tolerance:4,fill:!0,stroke:!0,segments:!0}),o=e&&e.item;if(o){var n="segment"===e.type;o.bounds.selected=!n,n&&(o=e.segment),o.selected=!0}D.prevSelection=o},U=function(){I()},R=new a.a.Tool;R.onMouseDown=F,R.onToggleOut=U;var J={path:null,carryLength:0},H=function(){J.path=new a.a.Path,J.path.fillColor=Y.state.brushArgs.color},q=function(t){if(J.path&&t.delta.length>1){var e=t.delta;e.angle=e.angle+90;var o=e.normalize().multiply(Y.state.brushArgs.size).multiply(1/e.length),n=t.middlePoint.add(o),s=t.middlePoint.subtract(o);J.carryLength=J.carryLength+e.length,J.carryLength>o.length&&(J.path.add(n),J.path.insert(0,s),J.path.smooth(),J.carryLength=0)}},W=function(){Y.state.brushArgs.shake&&J.path.simplify(),v.add(new y({path:J.path})),J.path=null},X=function(){},G=function(){},K=new a.a.Tool;K.onMouseDown=H,K.onMouseDrag=q,K.onMouseUp=W,K.onToggleIn=X,K.onToggleOut=G;var Q={pencil:x,eraser:M,select:R,brush:K};n["default"].use(d["a"]);var Y=new d["a"].Store({state:{image:"",capture:"",drawing:"",plant:{name:"",data:{}},toolName:null,canvasArgs:{bgColor:"#fff"},pencilArgs:{color:"#000000",size:10,shake:!0},eraserArgs:{size:20},brushArgs:{color:"#000000",size:20,shake:!0},drawSession:{step:0,description:""}},mutations:{reset:function(t){t.image="",t.capture="",t.drawing="",t.plant.name="",t.plant.data={},t.drawSession.step=0,t.drawSession.description=""},setImage:function(t,e){t.image=e},setCapture:function(t,e){t.capture=e},setDrawing:function(t,e){t.drawing=e},setPlant:function(t,e){t.plant.name=e},setPlantData:function(t,e){t.plant.data=e},setStep:function(t){t.drawSession.step<1&&t.drawSession.step++},setDescription:function(t,e){t.drawSession.description=e},setTool:function(t,e){t.toolName&&Q[t.toolName].onToggleOut&&Q[t.toolName].onToggleOut(),t.toolName=e,Q[e]&&(Q[e].activate(),Q[e].onToggleIn&&Q[e].onToggleIn())},setArgs:function(t,e){var o=e.toolName,n=e.color,s=e.size,a=e.shake,r=t[o+"Args"];r.color=n||r.color,r.size=s||r.size,void 0!==a&&(r.shake=a)},setCanvasArgs:function(t,e){Object.assign(t.canvasArgs,e)}},actions:{},modules:{}}),Z=o("e37d"),tt=(o("b972"),o("8c4f")),et=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"canvas default w-full h-full flex flex-col justify-between items-center overflow-hidden"},[o("div",{staticClass:"absolute flex flex-row justify-between items-center bg-white rounded-b-2xl"},[o("VHeader")],1),o("canvas",{ref:"canvas",staticClass:"w-full h-screen",style:t.cursor+t.canvasBg,attrs:{id:"canvas",resize:""}}),o("VDialogue",{ref:"sidebar",staticClass:"absolute top-1/2 left-0 transform -translate-y-2/3 transition duration-500 ease-in-out",on:{click:t.toggleSideBar}})],1)},ot=[],nt=(o("b680"),function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"flex items-center justify-center flex-wrap w-96 h-20"},[o("VTools",{staticClass:"transform -translate-y-3"})],1)}),st=[],at=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"flex items-center"},[o("div",{staticClass:"pr-10",staticStyle:{height:"60px"}},[o("div",{staticClass:"color w-14 h-14 rounded-full transition duration-300 ease-in-out",style:{backgroundColor:t.pencilArgs.color}})]),o("VPicker",{staticClass:"transform pr-10"}),o("v-popover",{attrs:{disabled:t.disabledSize,offset:"16"}},[o("VIconBtn",{ref:"pencil",staticClass:"transform -translate-y-5 transition duration-300 ease-in-out pr-10",attrs:{title:"画笔(P)",active:"pencil"===t.toolName,name:"pencil"},on:{click:function(e){return t.setTool("pencil")}}}),o("template",{slot:"popover"},[o("div",{staticClass:"v-size-picker"},[o("VueSlider",{attrs:{min:1},model:{value:t.size,callback:function(e){t.size=e},expression:"size"}})],1)])],2),o("v-popover",{attrs:{disabled:t.disabledSize,offset:"16"}},[o("VIconBtn",{ref:"eraser",staticClass:"transform transition duration-300 ease-in-out",attrs:{title:"擦除(E)",active:"eraser"===t.toolName,name:"eraser"},on:{click:function(e){return t.setTool("eraser")}}}),o("template",{slot:"popover"},[o("div",{staticClass:"v-size-picker"},[o("VueSlider",{attrs:{min:1},model:{value:t.size,callback:function(e){t.size=e},expression:"size"}})],1)])],2)],1)},rt=[],it=o("5530"),lt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{on:{click:t.handleClick}},[o("i",[o("img",{attrs:{src:t.src,alt:t.name}})])])},ct=[],ut={props:{active:Boolean,disabled:Boolean,name:String},computed:{src:function(){return"https://raw.githubusercontent.com/chaochaooo/Bio_Sketchbook/main/public/assets/svg/"+this.name+".svg"}},methods:{handleClick:function(t){this.disabled||this.$emit("click",t)}}},ht=ut,dt=Object(l["a"])(ht,lt,ct,!1,null,"6cc9eac0",null),pt=dt.exports,ft=o("4971"),mt=o.n(ft),vt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"flex flex-row items-center"},[o("v-popover",{attrs:{disabled:t.disabledColor,offset:"16"}},[o("VIconBtn",{attrs:{disabled:t.disabledColor,title:"颜色",color:t.color,name:"color"}}),o("template",{slot:"popover"},[o("div",{staticClass:"bg-white pl-3 pt-5"},[o("VSwatches",{attrs:{swatches:t.swatches,"row-length":"5",inline:""},model:{value:t.color,callback:function(e){t.color=e},expression:"color"}})],1)])],2)],1)},gt=[],bt=o("c345"),wt=o("7f75"),yt=o.n(wt),kt=(o("b3a4"),{components:{VIconBtn:pt,CompactPicker:bt["Compact"],SwatchesPicker:bt["Swatches"],VSwatches:yt.a},data:function(){return{color:"#000000",swatches:[["#FF6900","#FCB900","#7BDCB5","#388E3C","#1B5E20"],["#8ED1FC","#0693E3","#EB144C","#F78DA7","#9900EF"],["#5D4037","#A1887F","#ABB8C3","#000000"]]}},computed:Object(it["a"])(Object(it["a"])({},Object(d["b"])(["toolName"])),{},{toolArgs:function(){return this.$store.state[this.toolName+"Args"]||{}},disabledColor:function(){return null===this.toolName||"eraser"===this.toolName}}),watch:{toolName:function(){this.toolArgs.color&&(this.color=this.toolArgs.color)},color:function(){this.toolArgs.color&&this.$store.commit("setArgs",{toolName:this.toolName,color:this.color})}}}),St=kt,Ct=Object(l["a"])(St,vt,gt,!1,null,"b7f6664a",null),jt=Ct.exports,zt=(o("8445"),{components:{VIconBtn:pt,VueSlider:mt.a,VPicker:jt},data:function(){return{size:1}},computed:Object(it["a"])(Object(it["a"])({},Object(d["b"])(["pencilArgs"])),{},{toolName:function(){return this.$store.state.toolName},toolArgs:function(){return this.$store.state[this.toolName+"Args"]||{}},disabledSize:function(){return null===this.toolName}}),watch:{toolName:function(){this.toolArgs.size&&(this.size=this.toolArgs.size)},size:function(){this.toolArgs.size&&this.$store.commit("setArgs",{toolName:this.toolName,size:this.size})}},methods:{setTool:function(t){"pencil"===t?(this.$refs["pencil"].$el.classList.remove("-translate-y-5"),this.$refs["pencil"].$el.classList.add("translate-y-2"),this.$refs["eraser"].$el.classList.remove("scale-110")):"brush"===t?(this.$refs["pencil"].$el.classList.remove("translate-y-2"),this.$refs["pencil"].$el.classList.add("-translate-y-5"),this.$refs["eraser"].$el.classList.remove("scale-110")):"eraser"===t&&(this.$refs["pencil"].$el.classList.remove("translate-y-2"),this.$refs["pencil"].$el.classList.add("-translate-y-5"),this.$refs["eraser"].$el.classList.add("scale-110")),this.$store.commit("setTool",t)}},mounted:function(){this.$refs["pencil"].$el.classList.remove("-translate-y-5"),this.$refs["pencil"].$el.classList.add("translate-y-2")}}),Ot=zt,$t=(o("318a"),Object(l["a"])(Ot,at,rt,!1,null,"20f8aef0",null)),At=$t.exports,xt=function(t){t||(t=w()());var e=new a.a.Layer({name:t});return a.a.project.addLayer(e),e},Tt=function(){return a.a.project.clear(),v.clear(),a.a.project},_t=o("9b6a"),Lt={components:{VTools:At,VIconBtn:pt,VPicker:jt},data:function(){return{history:v}},mounted:function(){Object(_t["a"])("ctrl+s",this.exportSvg),Object(_t["a"])("f1",this.help)},methods:{clear:function(){Tt(),xt()},undo:function(){v.undo()},redo:function(){v.redo()}}},Nt=Lt,Bt=Object(l["a"])(Nt,nt,st,!1,null,"7f247ccd",null),Pt=Bt.exports,Vt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"dialogue",staticClass:"dialogue-wrapper flex flex-row bg-white rounded-r-2xl"},[o("img",{staticClass:"pl-6",attrs:{src:"https://raw.githubusercontent.com/chaochaooo/Bio_Sketchbook/main/public/assets/svg/line.svg"}}),o("div",{on:{click:t.handleClick}},[t._m(0)])])},Et=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"pt-6"},[o("p",{staticClass:"dialogue"},[o("span",[t._v("你好呀，小朋友! 让我们开始写生吧！")])])])}];o("a15b"),o("d3b7"),o("3ca3"),o("ddb0"),o("2b3d"),o("9861");function Mt(t,e){var o="https://tsn.baidu.com/text2audio",n=e||{},s=t||{},a=document.createElement("audio");n.autoplay&&a.setAttribute("autoplay","autoplay"),n.hidden?a.style.display="none":a.setAttribute("controls","controls"),"undefined"!==typeof n.volume&&(a.volume=n.volume),f(n.onInit)&&n.onInit(a);var r=6e4,i=n.timeout||r,l=new XMLHttpRequest;l.open("POST",o);var c={};for(var s in t)c[s]=t[s];c.cuid=c.cuid||c.tok,c.ctp=1,c.lan=c.lan||"zh",c.aue=c.aue||3;var u=[];for(var h in c)u.push(h+"="+encodeURIComponent(c[h]));var d=new FileReader;l.responseType="blob",l.send(u.join("&"));var p=setTimeout((function(){l.abort(),f(n.onTimeout)&&n.onTimeout()}),i);function f(t){return"[object Function]"===Object.prototype.toString.call(t)}l.onreadystatechange=function(){4==l.readyState&&(clearTimeout(p),200==l.status&&("audio/mp3"===l.response.type&&(document.body.appendChild(a),a.setAttribute("src",URL.createObjectURL(l.response)),n.autoDestory&&(a.onended=function(){document.body.removeChild(a)}),f(n.onSuccess)&&n.onSuccess(a)),"application/json"===l.response.type&&(d.onload=function(){var t=d.result;f(n.onError)&&n.onError(t)},d.readAsText(l.response))))}}function Dt(t){console.log(t),Mt({tex:t,tok:"25.460eac2eaa96064987fb7d42b0bdebd9.315360000.1953616249.282335-24318664",spd:5,pit:5,vol:15,per:103},{volume:.3,autoDestory:!0,timeout:1e4,hidden:!0,autoplay:!0})}var It={methods:{handleClick:function(t){this.$emit("click",t)}},watch:{content:function(t){Dt(t)}},mounted:function(){this.$refs.dialogue.click(),Dt("你好呀，小朋友! 让我们开始写生吧！")}},Ft=It,Ut=(o("3329"),Object(l["a"])(Ft,Vt,Et,!1,null,"55d49f0c",null)),Rt=Ut.exports,Jt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{on:{click:t.handleClick}},[o("img",{attrs:{src:"https://raw.githubusercontent.com/chaochaooo/Bio_Sketchbook/main/public/assets/svg/next.svg"}})])},Ht=[],qt={methods:{handleClick:function(t){this.$router.push({path:"/plant"}),this.$emit("click",t)}}},Wt=qt,Xt=Object(l["a"])(Wt,Jt,Ht,!1,null,"eae2ffde",null),Gt=Xt.exports,Kt=function(t){Object(_t["a"])("b",(function(){return Y.commit("setTool","brush")})),Object(_t["a"])("p",(function(){return Y.commit("setTool","pencil")})),Object(_t["a"])("e",(function(){return Y.commit("setTool","eraser")})),Object(_t["a"])("a",(function(){return Y.commit("setTool","select")})),Object(_t["a"])("ctrl+z",(function(){return v.undo()})),Object(_t["a"])("ctrl+shift+z",(function(){return v.redo()})),Object(_t["a"])("ctrl+q",(function(){Tt(),xt()}))},Qt=function(t){a.a.setup(t.canvas),a.a.tool=null,Kt(t),document.getElementById("canvas").addEventListener("wheel",(function(e){t.vdrawArgs.zoom=a.a.view.zoom})),a.a.project.importJSON(window.localStorage.vdarw||[]),t.vdrawArgs.size=a.a.view.size,t.vdrawArgs.zoom=a.a.view.zoom,t.isInit=!0},Yt={components:{VHeader:Pt,VDialogue:Rt,VNext:Gt},data:function(){return{isInit:!1,vdrawArgs:{size:{width:0,height:0},zoom:0},svg:""}},methods:{toggleSideBar:function(){this.$refs["sidebar"].$el.classList.toggle("-translate-x-44")},exportSvg:function(){console.log("exportSvg");var t=paper.project.exportSVG(),e=btoa((new XMLSerializer).serializeToString(t)),o="data:image/svg+xml;base64,"+e;this.$store.commit("setDrawing",o)}},computed:{cursor:function(){var t=this.$store.state.toolName;return null===t||"brush"===t?"cursor: auto;":"select"!==t?"cursor: none;":"cursor: auto;"},canvasBg:function(){return"background-color: ".concat(this.$store.state.canvasArgs.bgColor,"fa;")},canvas:function(){return this.$refs.canvas}},mounted:function(){Qt(this),Tt(),xt(),this.$store.commit("setTool","pencil")},filters:{toFixed:function(t){return t.toFixed(2)}}},Zt=Yt,te=(o("cccb"),Object(l["a"])(Zt,et,ot,!1,null,null,null)),ee=te.exports;n["default"].use(tt["a"]);var oe=[{path:"/",name:"Home",component:ee}],ne=new tt["a"]({mode:"hash",base:"",routes:oe}),se=ne,ae=o("28dd");a.a.install(window),n["default"].prototype.$store=Y,n["default"].config.productionTip=!1,n["default"].use(Z["a"]),n["default"].use(ae["a"]);e["default"]=new n["default"]({store:Y,router:se,render:function(t){return t(h)}}).$mount("#app")},"5ced":function(t,e,o){},"73d7":function(t,e,o){},bb1f:function(t,e,o){},cccb:function(t,e,o){"use strict";var n=o("5ced"),s=o.n(n);s.a}});
//# sourceMappingURL=app.9b1fcfe4.js.map